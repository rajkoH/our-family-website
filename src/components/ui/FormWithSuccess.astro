---
import type { Form as Props } from '~/types';
import Button from '~/components/ui/Button.astro';

const { inputs, textarea, disclaimer, button = 'Contact us', description = '' } = Astro.props;
---

<div id="form-container">
  <!-- Success Message (hidden by default) -->
  <div id="success-message" class="hidden bg-green-50 dark:bg-green-900/20 border-2 border-green-200 dark:border-green-800 rounded-2xl p-8 text-center">
    <div class="w-16 h-16 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center mx-auto mb-4">
      <span class="text-4xl">âœ“</span>
    </div>
    <h3 class="text-2xl font-bold text-green-800 dark:text-green-200 mb-2">Message Sent!</h3>
    <p class="text-green-700 dark:text-green-300 mb-4">
      Thank you for reaching out. We've received your message and will get back to you soon.
    </p>
    <button
      type="button"
      onclick="location.reload()"
      class="text-primary hover:text-secondary font-semibold transition-colors"
    >
      Send Another Message
    </button>
  </div>

  <!-- Form (visible by default) -->
  <form id="contact-form" action="https://formspree.io/f/xpwvkozg" method="POST">
    {
      inputs &&
        inputs.map(
          ({ type = 'text', name, label = '', autocomplete = 'on', placeholder = '' }) =>
            name && (
              <div class="mb-6">
                {label && (
                  <label for={name} class="block text-sm font-medium">
                    {label}
                  </label>
                )}
                <input
                  type={type}
                  name={name}
                  id={name}
                  autocomplete={autocomplete}
                  placeholder={placeholder}
                  required
                  class="py-3 px-4 block w-full text-md rounded-xl border-2 border-amber-200 dark:border-orange-800 bg-white dark:bg-stone-900 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-colors"
                />
              </div>
            )
        )
    }

    {
      textarea && (
        <div>
          <label for="textarea" class="block text-sm font-medium">
            {textarea.label}
          </label>
          <textarea
            id="textarea"
            name={textarea.name ? textarea.name : 'message'}
            rows={textarea.rows ? textarea.rows : 4}
            placeholder={textarea.placeholder}
            class="py-3 px-4 block w-full text-md rounded-xl border-2 border-amber-200 dark:border-orange-800 bg-white dark:bg-stone-900 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-colors"
            required
          />
        </div>
      )
    }

    {
      disclaimer && (
        <div class="mt-3 flex items-start">
          <div class="flex mt-0.5">
            <input
              id="disclaimer"
              name="disclaimer"
              type="checkbox"
              class="cursor-pointer mt-1 w-4 h-4 text-primary bg-white border-2 border-amber-300 rounded focus:ring-2 focus:ring-primary/20 dark:bg-stone-900 dark:border-orange-800"
            />
          </div>
          <div class="ml-3">
            <label for="disclaimer" class="cursor-pointer select-none text-sm text-gray-600 dark:text-gray-400">
              {disclaimer.label}
            </label>
          </div>
        </div>
      )
    }

    {
      button && (
        <div class="mt-10 grid">
          <Button variant="primary" type="submit">
            {button}
          </Button>
        </div>
      )
    }

    {
      description && (
        <div class="mt-3 text-center">
          <p class="text-sm text-gray-600 dark:text-gray-400">{description}</p>
        </div>
      )
    }
  </form>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form');
    const successMessage = document.getElementById('success-message');

    if (form && successMessage) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData(form);

        try {
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });

          if (response.ok) {
            form.style.display = 'none';
            successMessage.classList.remove('hidden');
            form.reset();
          } else {
            const data = await response.json();
            if (data.errors) {
              alert('Oops! There was a problem: ' + data.errors.map(error => error.message).join(', '));
            } else {
              alert('Oops! There was a problem submitting your form. Please try sending us an email directly at ryandylanhome@gmail.com');
            }
          }
        } catch (error) {
          alert('Oops! There was a problem submitting your form. Please try sending us an email directly at ryandylanhome@gmail.com');
        }
      });
    }
  });
</script>

